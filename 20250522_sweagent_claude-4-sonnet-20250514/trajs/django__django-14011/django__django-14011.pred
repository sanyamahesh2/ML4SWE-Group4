{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "django__django-14011", "model_patch": "diff --git a/django/test/testcases.py b/django/test/testcases.py\nindex 92f566b7b0..32b85d5194 100644\n--- a/django/test/testcases.py\n+++ b/django/test/testcases.py\n@@ -1400,6 +1400,15 @@ class QuietWSGIRequestHandler(WSGIRequestHandler):\n     def log_message(*args):\n         pass\n \n+    def handle(self):\n+        \"\"\"Handle a request, ensuring database connections are closed afterwards.\"\"\"\n+        try:\n+            super().handle()\n+        finally:\n+            # Close database connections to prevent \"database is being accessed\n+            # by other users\" errors during test teardown.\n+            connections.close_all()\n+\n \n class FSFilesHandler(WSGIHandler):\n     \"\"\"\n@@ -1473,10 +1482,22 @@ class _MediaFilesHandler(FSFilesHandler):\n         return settings.MEDIA_URL\n \n \n+class _LiveServerTestThreadedWSGIServer(ThreadedWSGIServer):\n+    \"\"\"\n+    A ThreadedWSGIServer subclass that properly closes database connections\n+    in worker threads to avoid \"database is being accessed by other users\"\n+    errors during test teardown.\n+    \"\"\"\n+    # Don't make request-handling threads daemon threads. This ensures that\n+    # the server waits for all threads to complete before shutting down,\n+    # giving them a chance to close their database connections.\n+    daemon_threads = False\n+\n+\n class LiveServerThread(threading.Thread):\n     \"\"\"Thread for running a live http server while the tests are running.\"\"\"\n \n-    server_class = ThreadedWSGIServer\n+    server_class = _LiveServerTestThreadedWSGIServer\n \n     def __init__(self, host, static_handler, connections_override=None, port=0):\n         self.host = host\n"}