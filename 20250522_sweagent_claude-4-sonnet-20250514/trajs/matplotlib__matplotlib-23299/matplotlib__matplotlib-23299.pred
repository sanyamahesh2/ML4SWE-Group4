{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "matplotlib__matplotlib-23299", "model_patch": "diff --git a/lib/matplotlib/__init__.py b/lib/matplotlib/__init__.py\nindex c268a56724..d791695fd0 100644\n--- a/lib/matplotlib/__init__.py\n+++ b/lib/matplotlib/__init__.py\n@@ -674,7 +674,14 @@ class RcParams(MutableMapping, dict):\n             val = dict.__getitem__(self, key)\n             if val is rcsetup._auto_backend_sentinel:\n                 from matplotlib import pyplot as plt\n-                plt.switch_backend(rcsetup._auto_backend_sentinel)\n+                # Resolve the backend without closing existing figures\n+                resolved_backend = plt._resolve_backend_sentinel()\n+                # Update both rcParams and rcParamsOrig with the resolved backend\n+                dict.__setitem__(self, key, resolved_backend)\n+                rcParamsOrig = globals().get(\"rcParamsOrig\")\n+                if rcParamsOrig is not None:\n+                    dict.__setitem__(rcParamsOrig, key, resolved_backend)\n+                return resolved_backend\n \n         return dict.__getitem__(self, key)\n \ndiff --git a/lib/matplotlib/pyplot.py b/lib/matplotlib/pyplot.py\nindex e3c66ea67c..534aec5515 100644\n--- a/lib/matplotlib/pyplot.py\n+++ b/lib/matplotlib/pyplot.py\n@@ -322,6 +322,50 @@ def switch_backend(newbackend):\n     install_repl_displayhook()\n \n \n+def _resolve_backend_sentinel():\n+    \"\"\"\n+    Resolve the _auto_backend_sentinel to an actual backend name without\n+    closing existing figures.\n+    \n+    This function is used when we need to determine what backend would be\n+    selected without actually switching to it (which would close figures).\n+    \"\"\"\n+    from matplotlib import rcsetup, cbook\n+    \n+    current_framework = cbook._get_running_interactive_framework()\n+    mapping = {'qt': 'qtagg',\n+               'gtk3': 'gtk3agg', \n+               'gtk4': 'gtk4agg',\n+               'wx': 'wxagg',\n+               'tk': 'tkagg',\n+               'macosx': 'macosx',\n+               'headless': 'agg'}\n+\n+    best_guess = mapping.get(current_framework, None)\n+    if best_guess is not None:\n+        candidates = [best_guess]\n+    else:\n+        candidates = []\n+    candidates += [\n+        \"macosx\", \"qtagg\", \"gtk4agg\", \"gtk3agg\", \"tkagg\", \"wxagg\"]\n+\n+    # Don't try to fallback on the cairo-based backends as they each have\n+    # an additional dependency (pycairo) over the agg-based backend, and\n+    # are of worse quality.\n+    for candidate in candidates:\n+        try:\n+            # Just try to import the backend module to see if it's available\n+            # without actually switching to it\n+            importlib.import_module(cbook._backend_module_name(candidate))\n+        except ImportError:\n+            continue\n+        else:\n+            return candidate\n+    else:\n+        # Agg should always be available\n+        return \"agg\"\n+\n+\n def _warn_if_gui_out_of_main_thread():\n     if (_get_required_interactive_framework(_get_backend_mod())\n             and threading.current_thread() is not threading.main_thread()):\n"}